<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>mAppWidget by lemberg</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>mAppWidget</h1>
        <p>mAppWidget is a code library designed for rapid design and integration of custom maps for Android mobile apps</p>

        <p class="view"><a href="https://github.com/lemberg/mappwidget">View the Project on GitHub <small>lemberg/mappwidget</small></a></p>


        <ul>
          <li><a href="https://github.com/lemberg/mappwidget/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/lemberg/mappwidget/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/lemberg/mappwidget">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
<a href="./">Home</a>

        <h1>How to Use</h1>

<p>Here you can find information on how to use mAppWidget library and FAQ's. If you have any question or problem which is not outlined here, please submit it using our support form.</p>

<h2>Introduction</h2>
<p>mAppWidget is an Android library designed specifically to simplify the development of custom offline map applications. It uses tile engine for rendering the map on the screen.</p>
<h2>Abstractions</h2>
<p>The offline map consists of an image that is sliced into tiles. Tiles are 
organised into several zoom levels. Zoom levels start from 0. At 0 zoom level, 
the map image’s dimensions are 1x1 pixels. At each next zoom level, the image 
size is twice increased.</p>
<p><img src="images/image07.png" alt="image07"></p>
<p>A map can have layers and map objects.</p>
<p>A layer is an abstraction that holds map objects. Layers can be visible or invisible. If a layer is invisible, objects that belong to this layer will not be displayed on the map.</p>
<p>A map object is the object that can be displayed on the map. A Drawable object is used to display it. Map objects can be added to any layer. The coordinates of the object are set in pixels.</p>
<p>To define an object’s location, coordinates use the image originally used for 
tile generation. The top left corner of the image is defined as having (0, 0) 
coordinates.</p>
<p>To define the location of a map object within the image, place the cursor at the spot and check its coordinates (you can use standard image editor). For example, point Bi n the image has coordinates of (350, 200) pixels.</p>
<p><img src="images/image15.png" alt="image15"></p>
<h2>Environment Setup</h2>
<p>First, you need to create a new project in the Eclipse development environment. The project can then be integrated into your app project by using EclipseпїЅs project management tools. A step-by-step guide below shows how to correctly create a map project.</p>
<h3>Step 1</h3>
<p>Create a new Android project</p>
<h3>Step 2</h3>
<p>Specify project details:</p>
<ul>
<li>Set project name</li>
<li>Check ‘Create new project in workspace’ radio button</li>
<li>Select Build target</li>
<li>Set Package name</li>
<li>Check and name Create activity</li>
<li>Set Min SDK Version</li>
</ul>
<p><img src="images/image161161.png" alt="image161161"></p>
<h3>Step 3</h3>
<p>Create ‘libs’ folder and put mapwidget_<version>.jar</version> there.</p>
<p><img src="images/image212.png" alt="image212"></p>
<p>Right click on mappwidget_1.2.0.jar and select ‘Add to Build Path’</p>
<p><img src="images/image141.png" alt="image141"></p>
<p>You should see mappwidget_1.2.0.jar in the ‘Referenced Libraries’ section.</p>
<p><img src="images/image09.png" alt="image09"></p>
<h3>Step 4</h3>
<p>Attach mappwidget javadoc. See “How to attach javadoc?” section for more 
details.</p>
<h3>Step 5</h3>
<p>Copy the map slices generated by the online tool to the assets folder. For more details, see the пїЅHow to create map assetsпїЅ section.</p>
<h3>Step 6</h3>
<p>In res/layout folder open the main.xml file in source view. Add the following element attribute to the root LinearLayout:</p>
<pre>android:id="@+id/mainLayout"</pre>
<h3>Step 7</h3>
<p>Open the main java class and paste the following code into onCreate:</p>
<pre>MapWidget map = new MapWidget(this, "map");
LinearLayout layout = (LinearLayout) findViewById(R.id.mainLayout);
layout.addView(map);
</pre>
<h3>Step 8</h3>
<p>Run it as an Android app.</p>

<h2>FAQ</h2>
<h2>How to attach javadoc to the library?</h2>
<p>Go to Project Properties → Java Build Path → Libraries. Select Javadoc 
location item of mappwidget jar and press “Edit...”.</p>
<p><img src="images/image12.png" alt="image12"></p>
		  <p>Check “Javadoc in archive” radio button.</p>
		  <p>Check “Workspace file” radio button.</p>
		  <p>Set the path to the mappwidget.jar into “Archive path” edit field.</p>
		  <p>Enter “javadoc” into the “Path within archive” edit field and press 
		  ok.</p>
<p><img src="images/image13.png" alt="image13"></p>

<h2>How to calibrate offline map in order to use geographic aware methods?</h2>
<p>The main idea of calibration is to define two points in pixels and map them 
according to the actual positions in geographical coordinates. Let’s take the 
Royal Park of London as an example.</p>
<p>This is the original image taken from the Open Street Map service:</p>
<p><img src="images/park.jpg" alt="park"></p>
<p>We will take two points that are pretty easy to find on Google Maps or any 
other map service (it may be crossroads or any other single object). We 
recommend using <a href="http://itouchmap.com/latlong.html" target="_blank">
http://itouchmap.com/latlong.html</a> service in order to have more precise 
latitude and longitude values.</p>
<p><img src="images/image02.png" alt="image02"></p>
<p><i>Note: Calibration rectangle can be smaller than the map image itself. Geo awareness methods will work on the entire map anyway.</i></p>
<p>Now we have two points and their location</p>

<h3>How to use Map Slicing Tool</h3>
<p>Open Eclipse Standard 4.3.2 and import "slicingtool" project. Now run this project as "Eclipse Application". As a result new Eclipse instance will be launched. Open "Map Slicing Tool" window:</p>
<p><img src="images/plugin_screenshot.png" alt="plugin"></p>

<p>and specify map source and slicing parameters. The result of slicing are one XML and a bunch of PNG files in specified directory tree. This directory tree should be placed in your project "assets" directory.</p>

<h3>Manual calibration</h3>
<p>In order to calibrate your offline map manually, you will need to make changes to the map.xml file that is located at assets/map/ folder.</p>
<p>Change the map.xml to match this example:</p>
		  <pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;image format="png" overlap="1" tilesize="256"&gt;&lt;size height="970" width="1665"&gt;
  &lt;calibrationrect&gt;
      &lt;point lat="51.512234697322576" lon="-0.18319487571716309" topleft="1" x="218" y="110"&gt;
      &lt;point lat="51.50428161952125" lon="-0.15317827463150024" x="1625" y="728"&gt;
  &lt;/calibrationrect&gt;
&lt;/image&gt;</pre>
<p>This is it.</p>

<h2>How to create map assets?</h2>
<p>Map assets can be generated using Map Slicing Tool. Copy results to the assets folder. You should have the following structure:</p>
<p><img src="images/image033.png" alt="image033"></p>
<p>Map assets has such structure:</p>
<p><img src="images/image1010.png" alt="image1010"></p>
<p>Folder names under &lt;map_name&gt;_files stand for zoom level. 0 is the 
lowest and 11 is the highest zoom level for the image. The highest 
zoom level holds your original image sliced to tiles. Each file name 
of any tile is created using the next pattern: &lt;column number&gt;_&lt;row 
number&gt;.png</p>
<p>&lt;map_name&gt;.xml is the configuration file for offline map.</p>
<h2>How to display map object on the map?</h2>
<p>In order to display a point of choice, you will need to complete these steps:</p>
<ul>
<li>Create a new layer or get an existing one.</li>
<li>Create a map object which represents your point of choice.</li>
<li>Add the map object to the layer.</li>
</ul>
<h3>Creating a new layer</h3>
<p>In order to create a layer, use this code snippet:</p>
<pre>int COFFEE_SHOPS_LAYER = 1;
Layer layer = mapWidget.createLayer(COFFEE_SHOPS_LAYER);</pre>
<h3>Getting an existing layer by id or index</h3>
<pre>int COFFEE_SHOPS_LAYER = 1;
Layer layer = mapWidget.getLayerById(COFFEE_SHOPS_LAYER);</pre>
<h3>Enumerating all existing layers</h3>
		  <pre>int layerCount = mapWidget.getLayerCount();
for (int i=0; i&lt;layerCount; ++i) {
    Layer layer = mapWidget.getLayer(i)
}</pre>
<h2>How to display map object using the geographic coordinates?</h2>
<p>In order to place the map object at some specific geographical location, you will need to:</p>
		  <ul>
			  <li>create a map object;</li>
			  <li>add the map object to the layer (at any position);</li>
			  <li>move the object using <span class="code">MapObject.moveTo</span> 
			  (Location location) method.</li>
		  </ul>
		  <p>Example:</p>
		  <pre>private void addPOI()
{
   Layer layer = map.getLayerById(SPORTS_LAYER);
   int objectId = 0;
       
   Drawable drawable = getResources().getDrawable(R.drawable.poi_sports);
   MapObject poiSport = new MapObject(objectId,
                                   drawable,
                                       0, 0, // Coordinate in pixels
                                       11, 33, // Pivot point
                                       true, // Touchable
                                       true); // Scalable        
   layer.addMapObject(poiSport);
       
   Location location = new Location("");
   location.setLatitude(51.50844864450185);
   location.setLongitude(-0.16513824462890625);  
   
   // It is obligatory to add map object to the layer before calling
   // moveTo mtehod
   poiSport.moveTo(location);
       
   objectId += 1;
}</pre>
<h2>How to get user’s position?</h2>
		  <p>You have two options for determining the current user’s position.</p>
		  <ul>
			  <li>Use Android’s standard way</li>
			  <li>Set listener to the MapWidget.</li>
		  </ul>
		  <h3>Standard way</h3>
		  <p>This code should be used in your Activity:</p>
		  <pre>LocationManager locManager = (LocationManager)
getSystemService(Context.LOCATION_SERVICE);
locManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, MIN_TIME,
MIN_DISTANCE, new LocationListener() {
           
    public void onStatusChanged(String provider, int status, Bundle extras) {          
    }
           
    public void onProviderEnabled(String provider) {
    }
           
    public void onProviderDisabled(String provider) {
               
    }
           
    public void onLocationChanged(Location location) {
         // Handle location change here      
    }
});</pre>
		  <h3>Set listener to MapWidget</h3>
		  <p>MapWidget uses Network location provider in order to get location 
		  immediately, and uses GPS location provider when it is ready.</p>
		  <p>This is an example of how to set the listener:</p>
		  <pre>private void initListeners()
{
   mapWidget.setOnLocationChangedListener(new OnLocationChangedListener() {
           
       public void onLocationChanged(MapWidget v, Location location) {
           Layer layer = v.getLayerById(LAYER_ID);
           MapObject object = layer.getMapObject(OBJECT_ID);
               
           object.moveTo(location);
       }
   });
}</pre>
<p>Also, you may want to configure the location request interval. You can do 
that by using the next code snippet:</p>
		  <pre>private void configureMapWidget()
{
   GPSConfig gpsConfig = mapWidget.getGpsConfig();
   gpsConfig.setGPSUpdateInterval(MIN_TIME_INTERVAL, MIN_DISTANCE_IN_METERS);
}</pre>
<h2>How to handle touch events on the map objects?</h2>
		  <p>In order to receive touch events, you need to set
		  <span class="code">OnMapTouchListener</span>.</p>
		  <p>Example:</p>
		  <pre>private void initMapEventsListener()
{
       mapWidget.setOnMapTouchListener(new OnMapTouchListener() {    
           public void onTouch(MapWidget map, MapTouchedEvent event) {
               
               List<objecttouchevent> objectTouchEvents = event.getTouchedObjectIds();

               // X coordinate of the touch in original image coordinates
               int mapX = event.getMapX();  

   // Y coordinate of the touch in original image coordinates

   int mapY = event.getMapY();

   // X coordinate of the touch in screen coordinates                 

   int screenX = event.getScreenX();

   // Y coordinate of the touch in screen coordinates
               int screenY = event.getScreenY();
               
               if (objectTouchEvents.size() == 1) {
                   ObjectTouchEvent objectTouchEvent = objectTouchEvents.get(0);
                   // Id of the layer that the map object belongs to
                   long layerId = objectTouchEvent.getLayerId();
                   // Id of the map object that was touched.

</objecttouchevent>                   <objecttouchevent>Object objectId = objectTouchEvent.getObjectId();                     
                   Toast.makeText(BrowseMapDemoActivity.this, &quot;Touched object &quot; + objectId + &quot; on layer&quot; + layerId + &quot;, x: &quot; + mapX + &quot; y: &quot; + mapY, Toast.LENGTH_SHORT).show();
               }
           }
       });
   }</objecttouchevent></pre>
<h2>How to perform some actions before and after zoom has occurred?</h2>
		  <p>In order to perform an operation before or after zooming, you can 
		  add instance of <span class="code">MapEventsListener</span> to the 
		  MapWidget. Use <span class="code">MapWidget.removeMapEventsListener</span> 
		  to remove the listener from the mApp widget.</p>
		  <p>For example:</p>
		  <pre>mapWidget.addMapEventsListener(new MapEventsListener() {
           
   public void onPreZoomOut() {
       // You can hide your map object's pop-up here
   }
           
   public void onPreZoomIn() {
       // You can hide your map object's pop-up here
   }
           
   public void onPostZoomOut() {
   }
           
   public void onPostZoomIn() {
   }
});</pre>
<h2>How to scroll the map to some location?</h2>
		  <p>You can do this by using one of these methods:</p>
		  <ul>
			  <li><span class="code">
			  MapWidget.scrollMapTo(android.location.Location location); </span>
			  </li>
			  <li><span class="code">
			  MapWidget.scrollMapTo(android.graphics.Point position); 
			  MapWidget.scrollToCurrentLocation();</span></li>
			  <li><span class="code">MapWidget.jumpTo(android.location.Location 
			  location); </span></li>
			  <li><span class="code">MapWidget.jumpTo(android.graphics.Point 
			  position); MapWidget.jumpToCurrentLocation();</span></li>
		  </ul>
		  <ul>
			  <li><span class="code">scrollXXX</span> methods use animation in 
			  order to scroll the map to a specific location.</li>
			  <li><span class="code">jumpXXX</span> methods do not use 
			  animation.</li>
		  </ul>
		  <p>Your map should be calibrated in order to use methods that receive
		  <span class="code">android.location.Location</span> as a parameter. 
		  Otherwise an exception will be thrown.</p>
<h2>How to show current user’s location?</h2>
		  <p>To show the current user’s location, you should follow these steps:</p>
		  <ul>
			  <li>Add <span class="code">ACCESS_COARSE_LOCATION</span> and
			  <span class="code">ACCESS_FINE_LOCATION</span> permissions to the 
			  AndroidManifest.xml</li>
			  <li>use <span class="code">mapWidget.setShowMyPosition(true)</span> 
			  in order to show the current user’s position</li>
		  </ul>
		  <p>As a result, you should see the position marker on the map:</p>
<p><img src="images/image055.png" alt="image055"></p>
		  <h3>How to change the way in which location pointer is pointing?</h3>
		  <p>The location marker consists of a round pointer, arrow pointer, 
		  accuracy area and accuracy area’s border. You can change each element 
		  of the marker.</p>
		  <p>In order to do that, you will need to take these steps:</p>
		  <ul>
			  <li>Get two images: round_pointer.png(<img alt="" src="images/image19.png" style="padding: 0; border:0; display: inline; margin: 0; width: 25px; height: 25px;">)and 
			  arrow_pointer.png(<img alt="" src="images/image20.png" style="padding: 0; border:0; display: inline; margin: 0; width: 33px; height: 33px;">).Please 
			  note that the arrow should face North in order to show the correct 
			  user’s direction.</li>
			  <li>Put the images into res/drawable folder.</li>
			  <li>Use the <span class="code">configureLocationPointer()</span> 
			  code snippet to change the pointer’s view:</li>
		  </ul>
		  <pre>private void configureLocationPointer()
{
  MapGraphicsConfig graphicsConfig = map.getMapGraphicsConfig();
       
  graphicsConfig.setAccuracyAreaColor(0x55FF0000); //Transparent Red
  graphicsConfig.setAccuracyAreaBorderColor(Color.RED);
  graphicsConfig.setDotPointerDrawableId(R.drawable.round_pointer);
  graphicsConfig.setArrowPointerDrawableId(R.drawable.arrow_pointer);
}</pre>
		  <p>If everything goes well, you should get something like this:</p>
<p><img src="images/image177.png" alt="image177"></p>
		  <p>The arrow pointer is displayed if bearing information is available, 
		  round pointer is used in all other cases.</p>
		  <p>Accuracy area shows accuracy of the GPS location calculation.</p>
<p><img src="images/image444.png" alt="image444"></p>
<h2>How to show/hide map objects of any type?</h2>
		  <p>To show or hide map objects, you will need to place them into 
		  separate layers. Then just set layer visibility to true or false.</p>
		  <p>Example:</p>
		  <pre>Layer sportsLayer  = mapWidget.getLayerById(SPORTS_LAYER);
sportsLayer.setVisible(true); // Shows the layer
sportsLayer.setVisible(false); // Hides the layer</pre>
<h2>How to use more than one map in a single application?</h2>
		  <p>Navigate to the slicing tool web page and create a map with a 
		  different name and put it in the assets folder.</p>
		  <p>The result should look like this:</p>
<p><img src="images/image08.png" alt="image08"></p>
		  <p>In the code, you will be able to use your maps in the following 
		  way:</p>
		  <pre>map = new MapWidget(this, "map", initZoomLevel);
or
map = new MapWidget(this, "map2", initZoomLevel);</pre>
<h2>How to zoom in/out?</h2>
		  <p>There are several methods of zooming in and out available by 
		  default. There are:</p>
		  <ul>
			  <li>Default zoom buttons at the bottom of the widget.</li>
			  <li>Double tap on the widget.</li>
			  <li>Pinch gesture.</li>
			  <li>Hardware buttons, ‘I’ for zoom in and ‘O’ for zoom out (only 
			  if the device has hardware keyboard).</li>
		  </ul>
<p><img src="images/image111.png" alt="image111"></p>

		  <p>Also, you can implement your own buttons in order to zoom in/out.</p>
		  <p>In order to zoom in by one zoom level, call:</p>
		  <pre>mapWidget.zoomIn();</pre>
		  <p>In order to zoom out by one zoom level, call:</p>
		  <pre>mapWiget.zoomOut();</pre>
		  <p>In order to retrieve the current zoom level, call:</p>
		  <pre>mapWidget.getZoomLevel();</pre>
		  <p>Initial zoom level is set via MapWidget’s constructor. For example, 
		  in order to set initial zoom level to 11, use:</p>
		  <pre>int initialZoomLevel = 11;
MapWidget mapWidget = new MapWidget(this, "map", initialZoomLevel);</pre>
<h2>What to do when user has touched more than one map object at a time?</h2>
		  <p>In this case, the best option is to show a dialog box with a list 
		  of objects that a user has touched. For that, you will need to 
		  implement <span class="code">OnMapTouchListener</span> properly.</p>
		  <p>Please, refer to this example of how to do this:</p>
		  <pre>mapWidget.setOnMapTouchListener(new OnMapTouchListener() {    
   public void onTouch(MapWidget map, MapTouchedEvent event) {
               
       List<objecttouchevent> objectTouchEvents = event.getTouchedObjectIds();
       
</objecttouchevent>       <objecttouchevent>// X coordinate of the touch in original image coordinates
       int mapX = event.getMapX();         
       // Y coordinate of the touch in original image coordinates
       int mapY = event.getMapY();  
</objecttouchevent>       <objecttouchevent>// X coordinate of the touch in screen coordinates
       int screenX = event.getScreenX();
       // Y coordinate of the touch in screen coordinates
       int screenY = event.getScreenY();
               
       if (objectTouchEvents.size() == 1) {
           ObjectTouchEvent objectTouchEvent = objectTouchEvents.get(0);
                   
</objecttouchevent>       <objecttouchevent>// Id of the layer that the map object belongs to
           long layerId = objectTouchEvent.getLayerId();
</objecttouchevent>       <objecttouchevent>// Id of the map object that was touched.
           Object objectId = objectTouchEvent.getObjectId();
                   
</objecttouchevent>       <objecttouchevent>// Handle single object touch event here
       } else if (objectTouchEvents.size() &gt; 1) {
             List</objecttouchevent></pre>

      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/lemberg">lemberg</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>